<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toque y Fama</title>
    <style>
        :root { 
            --primary: #1c3e50; 
            --bg: #54c7ff; 
            --state-used: #aee9ff;  /* Celeste Usado */
            --state-none: #ffffff;    
            --state-discard: #d1d8e0; 
            --state-toque: #a8f6c9;   /* Verde Toque */
            --state-fama: #fffac4;    /* Amarillo Fama */
            --state-win: #ff9800;
        }
        body { font-family: 'Arial', sans-serif; background: var(--bg); margin: 0; padding: 15px; height: 100vh; overflow: hidden; }
        
        .main-layout { display: flex; gap: 20px; height: 100%; align-items: flex-start; }

        /* Columna 1: Panel de Control */
        .control-column { width: 240px; flex-shrink: 0; display: flex; flex-direction: column; gap: 15px; }
        .input-row { display: flex; align-items: center; gap: 8px; font-weight: bold; font-size: 1.1rem; min-height: 40px; }
        input { width: 80px; padding: 6px; font-size: 1.2rem; border: 1px solid #000; border-radius: 4px; text-align: center; }
        #start-btn { padding: 8px 25px; background: var(--primary); color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 1rem; }

        #input-container { display: none; align-items: center; gap: 8px; }
        #tools-container { display: none; flex-direction: column; }

        .digit-board { display: grid; grid-template-columns: repeat(5, 42px); gap: 8px; margin-top: 10px; }
        .digit-box { height: 40px; border: 1px solid #999; border-radius: 3px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.1rem; background: var(--state-none); transition: background 0.3s; }

        .mark-help-box { background: #fff; border: 1px solid #ddd; padding: 10px; border-radius: 4px; font-size: 0.8rem; line-height: 1.4; box-shadow: 2px 2px 5px rgba(0,0,0,0.05); }
        .color-sample { display: inline-block; width: 14px; height: 14px; border: 1px solid #999; vertical-align: middle; margin: 0 4px; border-radius: 1px; }

        /* Columna 2: Historial Central */
        .history-column { flex-grow: 1; height: 95vh; overflow-y: auto; border-left: 1px solid #ddd; padding-left: 20px; }
        .history-item { padding: 8px 0; border-bottom: 1px solid #eee; display: flex; align-items: center; gap: 15px; }
        .hist-num { color: #888; font-weight: bold; font-size: 0.9rem; min-width: 20px; }
        .digit-group { display: flex; gap: 6px; }
        .hist-digit-btn { width: 32px; height: 32px; border: 1px solid #ccc; background: var(--state-used); border-radius: 2px; cursor: pointer; font-weight: bold; font-size: 0.9rem; }

        /* Columna 3: Cuadro de Reglas (Corregido) */
        .rules-column { width: 320px; flex-shrink: 0; background: #fff; border: 2px solid #000; padding: 15px; font-size: 0.82rem; line-height: 1.5; color: #000; max-height: 95vh; overflow-y: auto; }
        .rules-column h3 { margin-top: 0; font-size: 1rem; border-bottom: 1px solid #000; padding-bottom: 5px; }

        .bg-none { background-color: var(--state-none) !important; }
        .bg-used { background-color: var(--state-used) !important; }
        .bg-discard { background-color: var(--state-discard) !important; }
        .bg-toque { background-color: var(--state-toque) !important; }
        .bg-fama { background-color: var(--state-fama) !important; }
        .bg-win { background-color: var(--state-win) !important; color: white; }

        .result-tag { font-weight: bold; color: #1565c0; font-size: 0.85rem; margin-left: 10px; }
        #winMsg { color: var(--state-win); font-weight: bold; text-align: center; margin-top: 10px; font-size: 1.1rem; }
        .solution-area { margin-top: 20px; text-align: center; color: red; visibility: hidden; }
        .sol-digits { font-size: 2rem; font-weight: 900; letter-spacing: 4px; }
    </style>
</head>
<body>

<div class="main-layout">
    <div class="control-column">
        <div class="input-row" id="control-header">
            <button id="start-btn" onclick="startGame()">Iniciar</button>
            <div id="input-container">
                <span>Cifra:</span>
                <input type="text" id="userInput" maxlength="5" placeholder="00000" autocomplete="off">
            </div>
        </div>

        <div id="tools-container">
            <br>
            fondo blanco = Dígitos no usados
            <div class="digit-board" id="digitBoard"></div>
            <div id="winMsg"></div>
            <br><br>
            <div class="mark-help-box">
                <b>Clic en los dígitos de la derecha para marcar tus conclusiones:</b><br>
                • 1 Clic <span class="color-sample" style="background:var(--state-used)"></span> Usado<br>
                • 2 Clic <span class="color-sample" style="background:var(--state-discard)"></span> No pertenece<br>
                • 3 Clic <span class="color-sample" style="background:var(--state-toque)"></span> Es un <b>TOQUE</b><br>
                • 4 Clic <span class="color-sample" style="background:var(--state-fama)"></span> Es una <b>FAMA</b>
            </div>
            
            <div class="solution-area" id="solutionArea">
                <div class="sol-digits" id="solDigits"></div>
                <div style="font-weight:bold">Time Up</div>
            </div>
        </div>
    </div>

    <div class="history-column" id="historyColumn"><div id="historyList"></div></div>

    <div class="rules-column">
         <h3>Toque y Fama</h3>
        <b>Juego de lógica</b> en que debes descubrir una <b>Cifra</b> de <b>5 dígitos <font color="red">distintos</font></b>, generada por la página...<br><br>
        Ingresa cifras de <b>5 dígitos (<font color="blue">puedes incluir repetidos</font></b>) y la página mostrará la cantidad de <b>Toques</b> y <b>Famas</b>...<br><br>
        <b><font color="blue">Toques:</font></b> cuántos dígitos existen en distinta posición.<br>
        <b><font color="blue">Famas:</font></b> cuántos dígitos existen en la misma posición.<br>
        <font size=1>(si un dígito puede ser tanto TOQUE como FAMA entonces es FAMA)<br><br>
        <font size=2><b>Ejemplo</b><br>
        Cifra secreta: &nbsp;8 2 7 1 4<br>
        Ingresa Cifra: 1 8 7 5 4<br><br>
        Toques: 2 (los dígitos 1 y 8)<br>
        Famas: 2 (los dígitos 4 y 7)
    </div>
</div>

<script>
    let secretCode = "", attemptsAfterIdentified = 0, gameWon = false, digitStates = Array(10).fill(0);
    const historyList = document.getElementById('historyList'), input = document.getElementById('userInput'), winMsg = document.getElementById('winMsg'), digitBoard = document.getElementById('digitBoard'), solutionArea = document.getElementById('solutionArea'), solDigits = document.getElementById('solDigits'), startBtn = document.getElementById('start-btn'), inputContainer = document.getElementById('input-container'), toolsContainer = document.getElementById('tools-container');

    function startGame() {
        secretCode = ""; attemptsAfterIdentified = 0; gameWon = false; digitStates = Array(10).fill(0);
        historyList.innerHTML = ""; winMsg.innerHTML = ""; solutionArea.style.visibility = "hidden"; input.value = "";
        startBtn.style.display = "none"; inputContainer.style.display = "flex"; toolsContainer.style.display = "none";
        generateSecret(); createDigitBoxes(); input.focus();
    }

    function generateSecret() {
        let digits = ["0","1","2","3","4","5","6","7","8","9"];
        digits.sort(() => Math.random() - 0.5);
        secretCode = digits.slice(0, 5).join('');
    }

    function createDigitBoxes() {
        digitBoard.innerHTML = '';
        for (let i = 0; i <= 9; i++) {
            let box = document.createElement('div');
            box.className = 'digit-box bg-none'; box.id = `box-${i}`; box.innerText = i;
            digitBoard.appendChild(box);
        }
    }

    const stateClasses = ["bg-none", "bg-used", "bg-discard", "bg-toque", "bg-fama"];

    function globalSync() {
        for (let i = 0; i <= 9; i++) { document.getElementById(`box-${i}`).className = `digit-box ${stateClasses[digitStates[i]]}`; }
        document.querySelectorAll('.hist-digit-btn').forEach(btn => { btn.className = `hist-digit-btn ${stateClasses[digitStates[parseInt(btn.innerText)]]}`; });
    }

    function checkAllIdentified() { return secretCode.split('').every(d => digitStates[parseInt(d)] >= 3); }

    function endGame(victory) {
        gameWon = true; inputContainer.style.display = "none"; startBtn.style.display = "block"; toolsContainer.style.display = "none";
        if (victory) winMsg.innerHTML = "¡FELICITACIONES!";
    }

    input.addEventListener("keypress", (e) => { if (e.key === "Enter") checkGuess(); });

    function checkGuess() {
        if (gameWon) return;
        const guess = input.value;
        if (guess.length !== 5 || !/^\d+$/.test(guess)) return;
        if (historyList.children.length === 0) toolsContainer.style.display = "flex";

        guess.split('').forEach(d => { if (digitStates[parseInt(d)] === 0) digitStates[parseInt(d)] = 1; });

        let famas = 0, toques = 0, secretUsed = Array(5).fill(false), guessUsed = Array(5).fill(false);
        for (let i = 0; i < 5; i++) { if (guess[i] === secretCode[i]) { famas++; secretUsed[i] = true; guessUsed[i] = true; } }
        for (let i = 0; i < 5; i++) { if (!guessUsed[i]) { for (let j = 0; j < 5; j++) { if (!secretUsed[j] && guess[i] === secretCode[j]) { toques++; secretUsed[j] = true; break; } } } }

        const newItem = document.createElement('div');
        newItem.className = 'history-item';
        const digitGroup = document.createElement('div');
        digitGroup.className = 'digit-group';
        guess.split('').forEach(d => {
            const btn = document.createElement('button');
            btn.className = 'hist-digit-btn'; btn.innerText = d;
            btn.onclick = () => { if (gameWon) return; const n = parseInt(btn.innerText);
                digitStates[n] = (digitStates[n] === 0) ? 1 : ((digitStates[n] % 4) + 1); globalSync(); };
            digitGroup.appendChild(btn);
        });

        newItem.innerHTML = `<span class="hist-num">${(historyList.children.length + 1).toString().padStart(2, '0')}</span>`;
        newItem.appendChild(digitGroup);
        const resSpan = document.createElement('span');
        resSpan.className = 'result-tag';
        resSpan.innerText = `${famas} F / ${toques} T`;
        newItem.appendChild(resSpan);
        historyList.appendChild(newItem);
        globalSync();
        newItem.scrollIntoView({ behavior: 'smooth', block: 'end' });

        if (famas === 5) {
            digitGroup.querySelectorAll('.hist-digit-btn').forEach(btn => btn.className = 'hist-digit-btn bg-win');
            endGame(true);
        } else if (checkAllIdentified()) {
            attemptsAfterIdentified++;
            if (attemptsAfterIdentified > 5) { solDigits.innerText = secretCode; solutionArea.style.visibility = "visible"; endGame(false); }
        }
        input.value = "";
    }

    window.onload = () => { startBtn.style.display = "block"; inputContainer.style.display = "none"; toolsContainer.style.display = "none"; };
</script>
</body>
</html>
