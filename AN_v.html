<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Agujero Negro - Mobile</title>
    <style>
        :root { 
            --primary: #1c3e50; 
            --bg: #54c7ff; 
            --user-color: #7fdc7f;
            --ai-color: #f3d36b;
            --hole-color: #000000;
        }
        
        html, body { 
            height: 100dvh; 
            margin: 0; padding: 0; 
            overflow: hidden; 
            background: var(--bg);
            font-family: sans-serif;
        }

        body { display: flex; flex-direction: column; }

        /* Pantalla de Reglas */
        #intro-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100dvh;
            background: white; z-index: 100; padding: 25px; box-sizing: border-box;
            display: flex; flex-direction: column;
        }

        .rules-content { flex: 1; overflow-y: auto; color: #333; line-height: 1.5; }
        .rules-content h2 { color: var(--primary); margin-top: 0; }

        /* Pantalla de Juego */
        #game-screen {
            display: none;
            flex-direction: column;
            height: 100dvh;
            padding: 10px;
            box-sizing: border-box;
            justify-content: space-between;
        }

        /* Área de la Pirámide (Central) */
        .pyramid-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 0;
        }

        .row { display: flex; justify-content: center; margin: 2px 0; }

        .cell {
            width: 14vw; height: 14vw;
            max-width: 55px; max-height: 55px;
            margin: 3px;
            border: 2px solid #000;
            background: white;
            font-size: 1.2rem;
            font-weight: bold;
            display: flex; align-items: center; justify-content: center;
            border-radius: 8px;
            transition: transform 0.1s;
        }

        .cell.user { background: var(--user-color); }
        .cell.ai { background: var(--ai-color); }
        .cell.hole { background: var(--hole-color); color: white; border-color: #444; }

        /* Resultado e Info */
        .info-panel {
            flex: 0 0 auto;
            background: rgba(255,255,255,0.9);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            margin-bottom: 5px;
        }

        #result2 { font-weight: bold; font-size: 1.1rem; color: var(--primary); margin-bottom: 10px; }

        .btn-main {
            background: var(--primary); color: white; border: none;
            padding: 16px; font-size: 1.2rem; font-weight: bold;
            border-radius: 8px; width: 100%; cursor: pointer;
        }

        .legend {
            display: flex; justify-content: center; gap: 15px; font-size: 0.8rem; margin-top: 5px;
        }
        .dot { width: 12px; height: 12px; display: inline-block; border-radius: 3px; margin-right: 4px; border: 1px solid #666; }
    </style>
</head>
<body>

    <div id="intro-screen">
        <div class="rules-content">
            <h2>Agujero Negro</h2>
            <p>Un juego de estrategia donde colocas números del 1 al 10 en una pirámide.</p>
            <p><b>Cómo jugar:</b></p>
            <ul>
                <li>Toca una casilla para poner tu número actual (inicia en 1).</li>
                <li>La página pondrá su número inmediatamente después.</li>
                <li>Al final, la única casilla vacía se convierte en el <b>Agujero Negro</b>.</li>
                <li>El agujero y sus vecinos <b>desaparecen</b> (no suman puntos).</li>
            </ul>
            <p><b>Gana</b> quien logre la mayor suma con sus casillas sobrevivientes.</p>
        </div>
        <button class="btn-main" onclick="initGameFlow()">INICIAR JUEGO</button>
    </div>

    <div id="game-screen">
        <div class="pyramid-container" id="pyramid">
            </div>

        <div class="info-panel">
            <div id="result2">¡Tu turno! (Coloca el 1)</div>
            <div class="legend">
                <span><span class="dot" style="background:var(--user-color)"></span>Tú</span>
                <span><span class="dot" style="background:var(--ai-color)"></span>Página</span>
                <span><span class="dot" style="background:var(--hole-color)"></span>Hoyo</span>
            </div>
            <button id="reset-btn" class="btn-main" style="display:none; margin-top:10px; background:#27ae60" onclick="location.reload()">NUEVO JUEGO</button>
        </div>
    </div>

<script>
const ROWS = 6;
let positions = [];
let indexOf = new Map();
let boardVal, owner, dead, current, turn, holeIndex = -1, started = false;

// Inicializar estructura de datos
for(let r=0; r<ROWS; r++){
  for(let c=0; c<=r; c++){
    let i = positions.length;
    positions.push({r,c});
    indexOf.set(r+","+c, i);
  }
}

function neighbors(i){
  const {r,c} = positions[i];
  let arr = [];
  const cand = [[r,c-1],[r,c+1],[r-1,c-1],[r-1,c],[r+1,c],[r+1,c+1]];
  for(let [rr,cc] of cand){
    if(indexOf.has(rr+","+cc)) arr.push(indexOf.get(rr+","+cc));
  }
  return arr;
}

function initGameFlow() {
    document.getElementById('intro-screen').style.display = 'none';
    document.getElementById('game-screen').style.display = 'flex';
    render();
    resetGame();
}

function render(){
  const pyramid = document.getElementById("pyramid");
  pyramid.innerHTML = "";
  for(let r=0; r<ROWS; r++){
    let row = document.createElement("div");
    row.className = "row";
    for(let c=0; c<=r; c++){
      let idx = indexOf.get(r+","+c);
      let btn = document.createElement("div"); // Div para mejor control táctil
      btn.className = "cell";
      btn.id = "cell-" + idx;
      btn.onclick = () => clickCell(idx);
      row.appendChild(btn);
    }
    pyramid.appendChild(row);
  }
}

function paint(){
  positions.forEach((_, i) => {
    const cell = document.getElementById("cell-" + i);
    cell.className = "cell";
    if(i === holeIndex || dead[i]) cell.classList.add("hole");
    if(boardVal[i] != null){
      cell.textContent = boardVal[i];
      cell.classList.add(owner[i] == "U" ? "user" : "ai");
    } else {
      cell.textContent = "";
    }
  });
}

function clickCell(i){
  if(turn != "U" || boardVal[i] != null || holeIndex !== -1) return;

  boardVal[i] = current;
  owner[i] = "U";
  paint();
  turn = "A";
  document.getElementById("result2").textContent = "Página pensando...";

  setTimeout(() => {
    let e = empty();
    if(e.length <= 1){ endGame(); return; }

    let pick = e[Math.floor(Math.random() * e.length)];
    boardVal[pick] = current;
    owner[pick] = "A";
    paint();

    if(empty().length <= 1){ 
        endGame(); 
    } else {
        current++;
        turn = "U";
        document.getElementById("result2").textContent = "Tu turno: Coloca el " + current;
    }
  }, 400);
}

function empty() { return boardVal.map((v,i) => v==null?i:null).filter(v=>v!=null); }

function endGame(){
  let e = empty();
  let hole = e[0];
  holeIndex = hole;
  neighbors(hole).forEach(n => dead[n] = true);

  let sumU=0, sumA=0;
  for(let i=0; i<boardVal.length; i++){
    if(i==hole || dead[i]) continue;
    if(owner[i]=="U") sumU += boardVal[i];
    if(owner[i]=="A") sumA += boardVal[i];
  }

  paint();

  let res = "";
  if(sumU > sumA)      res = "¡GANASTE!";
  else if(sumA > sumU) res = "PERDISTE";
  else                res = "EMPATE";
  
  document.getElementById("result2").innerHTML = `${res}<br><small>Tú: ${sumU} pts - Página: ${sumA} pts</small>`;
  document.getElementById("reset-btn").style.display = "block";
}

function resetGame(){
  boardVal = Array(positions.length).fill(null);
  owner = Array(positions.length).fill(null);
  dead = Array(positions.length).fill(false);
  holeIndex = -1;
  current = 1;
  turn = "U";
  document.getElementById("result2").textContent = "Tu turno: Coloca el 1";
  paint();
}
</script>
</body>
</html>

